<?php

/**
 * @file
 * Formball page and game elements
 */

/**
 * Implements hook_init()
 */
function formball_game_init() {
  $session_id = session_id();
  $player_id = substr($session_id, 0, 7);
}

/**
 * Implements hook_preprocess_page()
 * Adds the game.css stylesheet
 * @param $variables
 */

function formball_game_preprocess_page(&$variables) {
  $module_path = drupal_get_path('module', 'formball_game');
  drupal_add_css( $module_path . '/css/game.css', array(
    'group' => CSS_THEME,
  ));
  drupal_add_css( $module_path . '/css/search-game.css', array(
    'group' => CSS_THEME,
  ));
  drupal_add_js($module_path . '/js/game_loop.js');
  $settings['autorefresh'] = variable_get('formball_game_refresh', 0);
  $settings['autorefresh_time'] = variable_get('formball_game_refresh_time', 0);
  drupal_add_js(array('formball_refresh' => $settings), 'setting');
  $variables['scripts'] = drupal_get_js();
  drupal_add_js($module_path . '/js/search_game.js');
}

/**
 * Implements hook_menu()
 */

function formball_game_menu() {

  // Search game page
  $items['search-game'] = array(
    'title' => 'Search for games',
    'description' => 'Page to search for available games',
    'page callback' => 'formball_search_game_page',
    'access callback' => TRUE,
    'file' => 'formball_search_game.page.inc',
  );

  // Search game ajax
  $items['search-game/%'] = array(
    'title' => 'Ajax search for games',
    'page callback' => 'formball_search_game_ajax',
    'page arguments' => array(1),
    'access callback' => TRUE,
    'file' => 'formball_search_game.page.inc',
    'type' => MENU_CALLBACK,
  );

  // Main game page
  $items['match/%'] = array(
    'title' => 'Title',
    'description' => 'Page and elements of the game',
    'page callback' => 'formball_game_page',
    'page arguments' => array(1),
    'access callback' => TRUE,
    'file' => 'formball_game.page.inc',
  );

  // setup the configuration page
  $items['admin/config/game'] = array(
    'title' => 'Formball',
    'description' => 'formball configuration',
    'page callback' => 'drupal_get_form',
    'page arguments' => array('formball_game_admin_settings'),
    'access callback' => TRUE,
    'file' => 'formball_game.admin.inc',
    'file path' => drupal_get_path('module', 'formball_game'),
  );
  return $items;
}

/**
 * Implements hook_theme().
 * @return array
 */
function formball_theme() {
  return array(
    // Theme function for the search form line up.
    'tabledrag_example_simple_form' => array(
      'render element' => 'form',
      'file' => 'includes/formball_search_line_up.inc',
    ),
  );
}